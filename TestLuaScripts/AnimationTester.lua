BasicPlayerAnimations = { 1, 2, 3, 5, 30, 33, 40, 41, 42, 43, 44, 45, 60, 61, 62, 63, 65, 66, 67, 68, 70, 71, 72, 73, 80, 81, 82, 83, 85, 86, 87, 88, 90, 91, 92, 93, 95, 96, 100, 101, 102, 103, 104, 105, 106, 107, 108, 110, 116, 117, 118, 130, 131, 132, 136, 137, 138, 140, 141, 142, 145, 146, 147, 150, 151, 152, 160, 162, 164, 200, 201, 202, 203, 204, 205, 206, 207, 210, 212, 214, 300, 301, 302, 303, 310, 311, 312, 313, 500, 501, 502, 503, 510, 511, 515, 517, 519, 520, 522, 524, 530, 531, 535, 536, 540, 541, 545, 546, 550, 551, 552, 553, 560, 561, 562, 563, 602, 603, 604, 605, 610, 620, 621, 640, 680, 690, 695, 696, 697, 698, 700, 701, 702, 703, 710, 711, 712, 713, 720, 721, 722, 723, 730, 731, 732, 733, 735, 736, 737, 738, 740, 741, 742, 743, 760, 761, 770, 800, 801, 802, 803, 804, 805, 806, 807, 900, 1500, 1510, 1520, 1550, 1560, 1570, 1580, --[[1600, 1610, 1620, Death]] 1650, 1660, 1670, 1750, 1755, 1760, 1765, 1766, 1767, 1770, 1780, 1790, 1800, 1801, 1802, 1803, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2020, 2021, 2022, 2024, 2025, 2026, 2027, 2030, 2031, 2032, 2033, 2034, 2035, 2036, 2037, 2040, 2045, 2050, 2051, 2052, 2053, 2054, 2055, 2056, 2057, 2060, 2061, 2062, 2063, 2064, 2065, 2066, 2067, 2070, 2071, 2072, 2073, 2075, 2076, 2077, 2080, 2081, 2082, 2083, 2085, 2086, 2087, 2088, 2100, 2101, 2200, 2201, 2202, 2203, 2204, 2205, 2206, 2207, 2210, 2211, 2212, 2213, 6000, 6001, 6010, 6011, 6020, 6021, 6030, 6031, 6040, 6041, 6050, 6051, 6052, 6053, 6055, 6060, 6065, 6066, 6067, 6070, 6071, 6072, 6073, 6074, 6075, 6076, 6080, 6081, 6082, 6083, 6084, 6100, 6101, 6110, 6111, 6120, 6121, 6130, 6131, 6140, 6141, 6150, 6151, 6152, 6153, 6155, 6160, 6165, 6170, 6171, 6172, 6173, 6174, 6175, 6176, 6180, 6181, 6182, 6183, 6184, 6200, 6201, 6202, 6203, 6204, 6205, 6206, 6207, 6208, 6209, 6210, 6211, 6212, 6213, 6214, 6215, 6216, 6217, 6218, 6219, 6220, 6221, 6222, 6224, 6225, 6226, 6299, 6300, 6302, 6303, 6304, 6305, 6306, 6307, 6308, 6309, 6310, 6311, 6312, 6313, 6314, 6315, 6316, 6317, 6318, 6319, 6320, 6322, 6324, 6325, 6326, 6399, 6400, 6401, 6402, 6403, 6404, 6405, 6406, 6407, 6408, 6409, 6410, 6411, 6412, 6413, 6414, 6415, 6416, 6417, 6418, 6419, 6420, 6422, 6424, 6425, 6426, 6500, 6502, 6503, 6504, 6505, 6506, 6507, 6508, 6509, 6510, 6511, 6512, 6513, 6514, 6515, 6516, 6517, 6518, 6519, 6520, 6522, 6524, 6525, 6526, 6600, 6613, 6625, 6725, 6800, 6801, 6802, 6803, 6804, 6805, 6806, 6807, 6808, 6809, 6810, 6815, 6820, 6825, 6830, 6950, 6951, 6952, 7000, 7001, 7002, 7003, 7004, 7005, 7010, 7011, 7012, 7013, 7014, 7020, 7021, 7022, 7023, 7024, 7030, 7031, 7033, 7035, 7036, 7037, 7038, 7040, 7041, 7043, 7045, 7046, 7047, 7048, 7050, 7051, 7052, 7060, 7061, 7062, 7063, 7064, 7110, 7111, 7112, 7113, 7114, 7120, 7150, 7151, 7152, 7410, 7411, 7412, 7413, 7414, 7500, 7501, 7502, 7503, 7504, 7510, 7520, 7521, 7522, 7530, 7540, 7541, 7550, 7560, 7561, 7562, 7570, 7571, 7580, 7585, 7586, 7587, 7588, 7589, 7600, 7605, 7610, 7615, 7620, 7625, 7630, 7635, 7640, 7645, 7697, 7698, 7699, 7700, 7701, 7702, 7710, 7711, 7712, 7720, 7721, 7722, 7725, 7800, 7801, 7802, 7805, 7810, 7815, 7816, 7817, 7820, 7821, 7825, 7830, 7835, 7840, 7845, 7850, 7855, 7856, 7860, 7865, 7870, 7875, 7876, 7877, 7880, 7885, 7890, 7891, 7895, 7896, 7897, 7898, 7900, 7905, 7910, 7911, 7912, 7913, 8000, 8001, 8005, 8006, 8010, 8020, 8021, 8022, 8023, 8130, 8280, 8281, 8282, 8283, 8284, 8285, 8286, 8287, 8288, 8289, 8290, 8300, 8305, 8400, 8401, 8402, 9000, 9001, 9002, 9010, 9011, 9012, 9020, 9021, 9022, 9023, 9024, 9030, 9031, 9032, 9033, 9034, 9040, 9041, 9042, 9043, 9044, 9050, 9051, 9052, 9060, 9061, 9062, 9063, 9064, 9070, 9071, 9072, 9080, 9081, 9082, 9090, 9091, 9092, 9093, 9094, 9100, 9101, 9102, 9103, 9104, 9110, 9111, 9112, 9120, 9121, 9122, 9130, 9131, 9132, 9140, 9141, 9142, 9143, 9144, 9150, 9151, 9152, 9153, 9154, 9160, 9161, 9162, 9163, 9164, 9170, 9171, 9172, 9190, 9191, 9192, 9200, 9201, 9202, 9203, 9210, 9211, 9212, 9220, 9221, 9222, 9223, 9224, 9230, 9231, 9232, 9233, 9234, 9240, 9241, 9242, 9250, 9251, 9252, 9253, 9254, 9260, 9261, 9262, 9263, 9264, 9270, 9271, 9272, 9273, 9274, 9280, 9281, 9282, 9290, 9291, 9292, 9300, 9301, 9302, 9303, 9304, 9310, 9311, 9312, 9313, 9314, 9320, 9321, 9322, 9330, 9331, 9332, 9340, 9341, 9342, 9343, 9344, 9350, 9351, 9352, 9360, 9361, 9362, 9370, 9371, 9372, 9380, 9381, 9382, 9383, 9384, 9390, 9391, 9392, 9400, 9401, 9402, 9410, 9411, 9412, 9420, 9421, 9422, 9430, 9431, 9432, 9440, 9441, 9442, 9450, 9451, 9452, 9460, 9600, 9610, 9990, 233980, 423980 }

PlayerAttackAnimations = { 0, 1, 2, 3, 5, 10, 40, 41, 42, 43, 44, 101, 200, 201, 202, 203, 204, 205, 206, 210, 211, 212, 213, 220, 221, 222, 300, 301, 302, 303, 304, 305, 306, 310, 311, 312, 313, 320, 321, 322, 1050, 1051, 1052, 1053, 1054, 1100, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2050, 2051, 2052, 2053, 2054, 10000, 10010, 10020, 10030, 10050, 10070, 10080, 10090, 12000, 12001, 12002, 12003, 12010, 12011, 12012, 12013, 13000, 13010, 13020, 13030, 13040, 14000, 14010, 14020, 15000, 15010, 15020, 15030, 16000, 16010, 16020, 16030, 16040, 16050, 16100, 16110, 16120, 16130, 16140, 16150, 16200, 16210, 16220, 16230, 16240, 16250, 17000, 18000, 18001, 18002, 18003, 19000, 19010, 19011, 19012, 19013, 19014, 19020, 19021, 19022, 19023, 19024, 20000, 20010, 21000, 22000, 23000, 23010, 24000, 25000, 26000, 27000, 28000, 30000, 30001, 30002, 30003, 30004, 30005, 30006, 30007, 30008, 30009, 30010, 30011, 30012, 30013, 30014, 30015, 30016, 30017, 30018, 30019, 30020, 30021, 30022, 30023, 30024, 30025, 30026, 30027, 30028, 30029, 30030, 2000000, 2000010, 2000020, 2000030, 2000040, 2000050, 2000100, 2000110, 2000200, 2000210, 2000220, 2000230, 2000240, 2000250, 2000300, 2000310, 2000400, 2000410, 2000420, 2000430, 2000440, 2000450, 2000490, 2000500, 2000505, 2000510, 2000515, 2000516, 2000520, 2000530, 2000540, 2000580, 2000600, 2001100, 2001110, 2001300, 2001310, 2002100, 2002110, 2002300, 2002310, 2003100, 2003110, 2003300, 2003310, 2004100, 2004110, 2004300, 2004310, 2300000, 2300010, 2300020, 2300030, 2300040, 2300050, 2300100, 2300110, 2300200, 2300210, 2300220, 2300230, 2300240, 2300250, 2300300, 2300310, 2300400, 2300410, 2300420, 2300430, 2300440, 2300450, 2300490, 2300500, 2300505, 2300510, 2300515, 2300516, 2300520, 2300530, 2300540, 2300580, 2300600, 2301000, 2301010, 2301020, 2301030, 2301040, 2301050, 2301100, 2301110, 2301200, 2301210, 2301220, 2301230, 2301240, 2301250, 2301300, 2301310, 2301400, 2301490, 2301500, 2301505, 2301510, 2301515, 2301516, 2301520, 2301530, 2301540, 2301580, 2302030, 2302100, 2302110, 2302230, 2302300, 2302310, 2302580, 2303100, 2303110, 2303300, 2303310, 2304100, 2304110, 2304300, 2304310, 2305100, 2305110, 2305300, 2305310, 2305320, 2305330, 2305580, 2305800, 2500000, 2500010, 2500020, 2500030, 2500040, 2500050, 2500100, 2500110, 2500200, 2500210, 2500220, 2500230, 2500240, 2500250, 2500300, 2500310, 2500400, 2500410, 2500420, 2500430, 2500440, 2500450, 2500490, 2500500, 2500505, 2500510, 2500515, 2500516, 2500520, 2500530, 2500540, 2500580, 2500600, 2501100, 2501110, 2501300, 2501310, 2502000, 2502010, 2502020, 2502030, 2502040, 2502050, 2502100, 2502110, 2502200, 2502210, 2502220, 2502230, 2502240, 2502250, 2502300, 2502310, 2502400, 2502490, 2502500, 2502505, 2502510, 2502515, 2502516, 2502520, 2502530, 2502540, 2502580, 2503100, 2503110, 2503800, 2504100, 2504110, 2504120, 2504130, 2504300, 2504310, 2504320, 2504330, 2504800, 2504801, 2505100, 2505110, 2505580, 2506100, 2506110, 2506300, 2506310, 2507100, 2507110, 2507300, 2507310, 2508100, 2508110, 2508300, 2508310, 2509300, 2509320, 2509800, 2600000, 2600001, 2600010, 2600020, 2600030, 2600040, 2600050, 2600100, 2600110, 2600200, 2600210, 2600220, 2600230, 2600240, 2600250, 2600300, 2600310, 2600400, 2600410, 2600420, 2600430, 2600440, 2600450, 2600490, 2600500, 2600501, 2600505, 2600506, 2600510, 2600511, 2600515, 2600516, 2600517, 2600520, 2600530, 2600540, 2600580, 2600600, 2601300, 2601310, 2601320, 2601330, 2601800, 2602100, 2602110, 2602300, 2602310, 2603100, 2603110, 2603300, 2603310, 2604100, 2604110, 2604300, 2604310, 2700000, 2700010, 2700020, 2700030, 2700040, 2700050, 2700100, 2700110, 2700200, 2700210, 2700220, 2700230, 2700240, 2700250, 2700300, 2700310, 2700400, 2700410, 2700420, 2700430, 2700440, 2700450, 2700460, 2700490, 2700500, 2700505, 2700510, 2700515, 2700516, 2700520, 2700530, 2700540, 2700580, 2700600, 2701100, 2701110, 2701300, 2701310, 2702100, 2702110, 2702300, 2702310, 2703100, 2703110, 2703300, 2703310, 2704100, 2704110, 2704300, 2704310, 2800000, 2800010, 2800020, 2800030, 2800040, 2800050, 2800100, 2800110, 2800200, 2800210, 2800220, 2800230, 2800240, 2800250, 2800300, 2800310, 2800400, 2800410, 2800420, 2800430, 2800440, 2800450, 2800490, 2800500, 2800505, 2800510, 2800515, 2800516, 2800520, 2800530, 2800540, 2800580, 2800600, 2801100, 2801110, 2801300, 2801310, 2802100, 2802110, 2802300, 2802310, 2803100, 2803110, 2803300, 2803310, 2804100, 2804110, 2804300, 2804310, 2805100, 2805110, 2805300, 2805310, 2805311, 2805400, 2805401, 2900000, 2900010, 2900020, 2900030, 2900040, 2900050, 2900100, 2900110, 2900200, 2900210, 2900220, 2900230, 2900240, 2900250, 2900300, 2900310, 2900400, 2900410, 2900420, 2900430, 2900440, 2900450, 2900490, 2900500, 2900505, 2900510, 2900515, 2900516, 2900520, 2900530, 2900540, 2900580, 2900600, 2901100, 2901110, 2901300, 2901310, 2902100, 2902110, 2902300, 2902310, 3000000, 3000010, 3000020, 3000030, 3000040, 3000050, 3000100, 3000110, 3000200, 3000210, 3000220, 3000230, 3000240, 3000250, 3000300, 3000310, 3000400, 3000410, 3000420, 3000430, 3000440, 3000450, 3000490, 3000500, 3000501, 3000505, 3000506, 3000510, 3000511, 3000515, 3000516, 3000517, 3000520, 3000530, 3000540, 3000580, 3000600, 3001000, 3001010, 3001020, 3001100, 3001110, 3001200, 3001210, 3001220, 3001300, 3001310, 3001400, 3002100, 3002110, 3002120, 3002130, 3002300, 3002301, 3002310, 3002800, 3003100, 3003110, 3003300, 3003310, 3004100, 3004110, 3004300, 3004310, 3200000, 3200010, 3200020, 3200030, 3200040, 3200050, 3200100, 3200101, 3200110, 3200200, 3200210, 3200220, 3200230, 3200240, 3200250, 3200300, 3200301, 3200310, 3200400, 3200410, 3200420, 3200430, 3200440, 3200450, 3200490, 3200500, 3200501, 3200505, 3200506, 3200510, 3200511, 3200515, 3200516, 3200517, 3200520, 3200530, 3200540, 3200580, 3200600, 3201300, 3201301, 3201310, 3201320, 3201330, 3201800, 3202100, 3202110, 3202300, 3202310, 3203000, 3203010, 3203020, 3203100, 3203110, 3203200, 3203210, 3203220, 3203300, 3203310, 3204100, 3204110, 3204300, 3204310, 3300000, 3300010, 3300020, 3300030, 3300040, 3300050, 3300100, 3300110, 3300200, 3300210, 3300220, 3300230, 3300240, 3300250, 3300300, 3300310, 3300400, 3300410, 3300420, 3300430, 3300440, 3300450, 3300490, 3300500, 3300501, 3300505, 3300506, 3300510, 3300511, 3300515, 3300516, 3300517, 3300520, 3300530, 3300540, 3300580, 3300600, 3301000, 3301010, 3301020, 3301030, 3301040, 3301050, 3301100, 3301110, 3301200, 3301210, 3301220, 3301230, 3301240, 3301250, 3301300, 3301310, 3301400, 3301490, 3301500, 3301501, 3301505, 3301506, 3301510, 3301511, 3301515, 3301516, 3301517, 3301520, 3301530, 3301540, 3301580, 3302000, 3302010, 3302020, 3302030, 3302040, 3302050, 3302100, 3302110, 3302200, 3302210, 3302220, 3302230, 3302240, 3302250, 3302300, 3302310, 3302400, 3302490, 3302500, 3302501, 3302505, 3302506, 3302510, 3302511, 3302515, 3302516, 3302517, 3302520, 3302530, 3302540, 3302580, 3303000, 3303010, 3303020, 3303030, 3303040, 3303050, 3303100, 3303110, 3303200, 3303210, 3303220, 3303230, 3303240, 3303250, 3303300, 3303310, 3303400, 3303490, 3303500, 3303501, 3303505, 3303506, 3303510, 3303511, 3303515, 3303516, 3303517, 3303520, 3303530, 3303540, 3303580, 3500000, 3500010, 3500020, 3500030, 3500040, 3500050, 3500100, 3500101, 3500110, 3500200, 3500210, 3500220, 3500230, 3500240, 3500250, 3500300, 3500301, 3500310, 3500400, 3500410, 3500420, 3500430, 3500440, 3500450, 3500490, 3500500, 3500501, 3500505, 3500506, 3500510, 3500511, 3500515, 3500516, 3500517, 3500520, 3500530, 3500540, 3500580, 3500600, 3500800, 3501100, 3501110, 3501300, 3501310, 3502100, 3502110, 3502300, 3502310, 3503100, 3503101, 3503110, 3503300, 3503310, 3600000, 3600010, 3600020, 3600030, 3600040, 3600050, 3600100, 3600110, 3600200, 3600210, 3600220, 3600230, 3600240, 3600250, 3600300, 3600310, 3600400, 3600410, 3600420, 3600430, 3600440, 3600450, 3600460, 3600490, 3600500, 3600505, 3600510, 3600515, 3600516, 3600520, 3600530, 3600540, 3600580, 3600600, 3601100, 3601110, 3601300, 3601310, 3601520, 3601521, 3601530, 3601531, 3602100, 3602101, 3602110, 3603100, 3603110, 3603120, 3603130, 3603300, 3603310, 3604100, 3604110, 3604300, 3604310, 3605100, 3605110, 3605300, 3605310, 3606100, 3606110, 3606300, 3606310, 3607300, 3607301, 3800000, 3800010, 3800020, 3800030, 3800040, 3800050, 3800100, 3800110, 3800200, 3800210, 3800220, 3800230, 3800240, 3800250, 3800300, 3800301, 3800310, 3800400, 3800410, 3800420, 3800430, 3800440, 3800450, 3800490, 3800500, 3800505, 3800510, 3800515, 3800516, 3800520, 3800530, 3800540, 3800580, 3800600, 3801000, 3801010, 3801020, 3801030, 3801040, 3801050, 3801100, 3801110, 3801200, 3801210, 3801220, 3801230, 3801240, 3801250, 3801300, 3801301, 3801310, 3801400, 3801490, 3801500, 3801505, 3801510, 3801515, 3801516, 3801520, 3801530, 3801540, 3801580, 3802000, 3802010, 3802020, 3802030, 3802040, 3802050, 3802100, 3802110, 3802200, 3802210, 3802220, 3802230, 3802240, 3802250, 3802300, 3802301, 3802310, 3802400, 3802490, 3802500, 3802505, 3802510, 3802515, 3802516, 3802520, 3802530, 3802540, 3802580, 3803100, 3803110, 3803300, 3803310, 3804100, 3804110, 3804300, 3804310, 3805100, 3805110, 3805300, 3805310, 5000000, 5000010, 5000020, 5000030, 5000040, 5000050, 5000100, 5000110, 5000200, 5000210, 5000220, 5000230, 5000240, 5000250, 5000300, 5000310, 5000400, 5000410, 5000420, 5000430, 5000440, 5000450, 5000490, 5000500, 5000505, 5000510, 5000515, 5000516, 5000520, 5000530, 5000540, 5000580, 5000600, 4100100, 4100300, 4100400, 4100430, 4100440, 4101100, 4101300, 4101400, 4102100, 4102300, 4102400, 4103100, 4103300, 4103400, 4103410, 4103420, 4104100, 4104110, 4104300, 4104310, 4104400, 4200000, 4200010, 4200020, 4200030, 4200040, 4200050, 4200100, 4200110, 4200400, 4200410, 4200430, 4200450, 4200490, 4200500, 4200501, 4200505, 4200510, 4200511, 4200515, 4200516, 4200517, 4200520, 4200540, 4200600, 4200700, 4200701, 4200702, 4200703, 4200900, 4200901, 4200902, 4200903, 4200904, 4200905, 4200906, 4200907, 4202000, 4202010, 4202020, 4202030, 4202040, 4202050, 4202100, 4202110, 4202400, 4202490, 4202500, 4202501, 4202505, 4202510, 4202511, 4202515, 4202516, 4202517, 4202520, 4202540, 4203100, 4203110, 4203120, 4203130, 4203400, 4203405, 4203430, 4204100, 4204110, 4400000, 4400100, 4400200, 4400300, 4400400, 4400410, 4400420, 4400430, 4400440, 4400450, 4400500, 4400510, 4400520, 4400530, 4400540, 4400580, 4400600, 4600000, 4600100, 4600200, 4600300, 4600400, 4600410, 4600420, 4600430, 4600440, 4600450, 4600500, 4600510, 4600520, 4600530, 4600540, 4600580, 4600600, 4700000, 4700010, 4700020, 4700030, 4700040, 4700050, 4700100, 4700110, 4700200, 4700210, 4700220, 4700230, 4700240, 4700250, 4700300, 4700310, 4700400, 4700410, 4700420, 4700430, 4700440, 4700520, 4700521, 4700530, 4700531, 4700540, 4700580, 4700600, 4700601, 4702100, 4702110, 4702300, 4702310, 4702400, 4800000, 4800010, 4800020, 4800030, 4800040, 4800050, 4800100, 4800110, 4800200, 4800210, 4800220, 4800230, 4800240, 4800250, 4800300, 4800301, 4800310, 4800400, 4800410, 4800420, 4800430, 4800440, 4800450, 4800520, 4800521, 4800530, 4800531, 4800540, 4800580, 4800600, 4802100, 4802110, 4802120, 4802130, 4802300, 4802310, 4802320, 4802330, 4802400, 4802405, 4802800, 4803000, 4803010, 4803020, 4803030, 4803040, 4803050, 4803100, 4803110, 4803200, 4803210, 4803220, 4803230, 4803240, 4803250, 4803300, 4803301, 4803310, 4803400, 4803410, 4803420, 4803430, 4803440, 4803450, 4803520, 4803521, 4803530, 4803531, 4803540, 4803580, 4803600, 5100000, 5100010, 5100020, 5100030, 5100040, 5100050, 5100100, 5100110, 5100200, 5100210, 5100220, 5100230, 5100240, 5100250, 5100300, 5100310, 5100400, 5100410, 5100420, 5100430, 5100440, 5100450, 5100490, 5100500, 5100501, 5100505, 5100506, 5100510, 5100511, 5100515, 5100516, 5100517, 5100520, 5100530, 5100540, 5100580, 5100600, 5101100, 5101110, 5101300, 5101310, 4300000, 4300010, 4300020, 4300030, 4300040, 4300050, 4300100, 4300110, 4300200, 4300210, 4300220, 4300230, 4300240, 4300250, 4300300, 4300310, 4300400, 4300410, 4300420, 4300430, 4300440, 4300450, 4300520, 4300530, 4300540, 4300580, 4300600 }

ANIM_ID = BasicPlayerAnimations

xinput_dll_offset = Module["XINPUT1_3.DLL"][1]; --The address "XInput1_3.dll + 0x0"
BTN_A        = 0x1000
BTN_B        = 0x2000
BTN_X        = 0x4000
BTN_Y        = 0x8000
BTN_LB       = 0x0100
BTN_RB       = 0x0200
BTN_HOME     = 0x0400
BTN_BACK     = 0x0020
BTN_LThumb   = 0x0040
BTN_RThumb   = 0x0080
BTN_START    = 0x0010
BTN_UP       = 0x0001
BTN_DOWN     = 0x0002
BTN_LEFT     = 0x0004
BTN_RIGHT    = 0x0008
BTN_CROSS    = 0x1000
BTN_CIRCLE   = 0x2000
BTN_SQUARE   = 0x4000
BTN_TRIANGLE = 0x8000
BTN_L1       = 0x0100
BTN_R1       = 0x0200
BTN_PS       = 0x0400
BTN_SELECT   = 0x0020
BTN_L3       = 0x0040
BTN_R3       = 0x0080

animId = 1;
mode = "Auto"

textPosX = 256;
textPosY = 16;

buttonBitmaskTextFormat = "ButtonMask: %04x";
buttonBitmaskTextPosX = textPosX;
buttonBitmaskTextPosY = textPosY + 24;

buttonBitmaskValue = 0;
prevButtonBitmaskValue = 0;

prevAnimId = 1

function SetTextPositions()
    SetLineHelpTextPos(buttonBitmaskTextPosX, buttonBitmaskTextPosY);
    SetKeyGuideTextPos(textPosX, textPosY);
end

function CheckButton(maskTest)
    return BitmaskCheck(buttonBitmaskValue, maskTest);
end

function CheckPrevButton(maskTest)
    return BitmaskCheck(prevButtonBitmaskValue, maskTest);
end

function CheckButtonPressed(maskTest)
    cur = CheckButton(maskTest);
    prev = CheckPrevButton(maskTest);
    
    return (cur and (not prev));
end

function BoolString(boolVal)
    if boolVal then
        return "true"
    else
        return "false"
    end
end

function ReadController()
    addr = RInt32(RInt32(xinput_dll_offset + 0x10C44)) + 0x0028
    buttonBitmaskValue = RUInt16(addr);
end

function GoToAnim(a)
    StopLoopAnimation(10000, animId);
    animId = math.max(math.min(a, #ANIM_ID), 1);
    if (mode == "Auto") then
        ForcePlayLoopAnimation(10000, ANIM_ID[animId]);
    end
    
    prevAnimId = animId
end

function NextAnim(delta)
    GoToAnim(animId + delta);
end

function PrevAnim(delta)
    GoToAnim(animId - delta);
end

function UpdatePlayback()
    
    deltaVal = 1;
    
    if CheckButton(BTN_L1) then
        deltaVal = deltaVal * 10
    end
    
    if CheckButtonPressed(BTN_TRIANGLE) then
        mode = "Auto"
        StopLoopAnimation(10000, ANIM_ID[prevAnimId]);
        ForcePlayLoopAnimation(10000, ANIM_ID[animId]);
    elseif CheckButtonPressed(BTN_CROSS) then
        mode = "Once"
        StopLoopAnimation(10000, ANIM_ID[prevAnimId]);
        ForcePlayAnimation(10000, ANIM_ID[animId]);
    elseif CheckButtonPressed(BTN_CIRCLE) then
        mode = "Stop"
        StopLoopAnimation(10000, ANIM_ID[prevAnimId]);
        StopLoopAnimation(10000, ANIM_ID[animId]);
    end
    
    if CheckButton(BTN_R1) then
        if (CheckButton(BTN_UP)) then
            NextAnim(deltaVal);
        elseif (CheckButton(BTN_DOWN)) then
            PrevAnim(deltaVal);
        end
    else
        if (CheckButtonPressed(BTN_UP)) then
            NextAnim(deltaVal);
        elseif (CheckButtonPressed(BTN_DOWN)) then
            PrevAnim(deltaVal);
        end
    end
    
    textFormat = "[LB/RB:ListFast, L3/R3:ListEnds, Y:PlayLoop, A:PlayOnce, B:Stop] AnimID: %d".."("..mode..")";
    
    SetKeyGuideText(string.format(textFormat, ANIM_ID[animId]));
end

function UpdatePrevVals()
    prevButtonBitmaskValue = buttonBitmaskValue;
end

--On Startup: 
ForcePlayLoopAnimation(10000, animId);
SetTextPositions();
PrintClearAll();
SetLineHelpTextClear();

while true do 
    ReadController();
    UpdatePlayback();
    UpdatePrevVals();
    Wait(33);
end